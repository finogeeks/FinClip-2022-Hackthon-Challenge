(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"102b":function(e,t,o){"use strict";(function(e){o("2968");n(o("66fd"));var t=n(o("9b61"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},1770:function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}));var n={uniDataCheckbox:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(o.bind(null,"0522"))}},r=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.goodsList,(function(t,o){var n=e.__get_orig(t),r=t.is_point?null:e._f("moneyFormat")(t.price),a=t.is_point&&""!=t.point_price?e._f("moneyFormat")(t.point_price):null;return{$orig:n,f0:r,f1:a}}))),n=e._f("moneyFormat")(e.total),r=e.pickupselfDiscountMoney>0?e._f("moneyFormat")(e.pickupselfDiscountMoney):null,a=e.editionSetting["enable_coupon"]?e._f("moneyFormat")(e.couponPar):null,s=e._f("moneyFormat")(e.total-e.couponPar-e.pickupselfDiscountMoney),i=e.__map(e.couponList,(function(t,o){var n=e.__get_orig(t),r=t.pid>0?e._f("moneyFormat")(t.product_price_low):null,a=t.pid>0?e._f("moneyFormat")(t.product_price_low-t.par):null,s=0===t.received?e.formatDate(t.end_time):null,i=0!==t.received?e.formatDate(t.expiration_time):null,u=0===t.received?e._f("moneyFormat")(t.par):null,c=0!==t.received?e._f("moneyFormat")(t.par):null;return{$orig:n,f6:r,f7:a,m0:s,m1:i,f8:u,f9:c}}));e._isMounted||(e.e0=function(t){e.showModal.member_point_password=!1},e.e1=function(t){e.showModal.order_point_password=!1}),e.$mp.data=Object.assign({},{$root:{l0:o,f2:n,f3:r,f4:a,f5:s,l1:i}})},a=[]},2450:function(e,t,o){},"4bf7":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("a34a")),r=o("2f62");function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,o,n,r,a,s){try{var i=e[a](s),u=i.value}catch(c){return void o(c)}i.done?t(u):Promise.resolve(u).then(n,r)}function i(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var a=e.apply(t,o);function i(e){s(a,n,r,i,u,"next",e)}function u(e){s(a,n,r,i,u,"throw",e)}i(void 0)}))}}function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var p=function(){o.e("components/common/copyright").then(function(){return resolve(o("749f"))}.bind(null,o)).catch(o.oe)},d=function(){Promise.all([o.e("common/vendor"),o.e("components/common/point-password-input")]).then(function(){return resolve(o("8ad2"))}.bind(null,o)).catch(o.oe)},f={components:{copyright:p,pointPassword:d},data:function(){return{showModal:{member_point_password:!1,order_point_password:!1},modalData:{coupon_issue_id:0,member_point_password:"",title:"",par:"",order_point_password:""},maskState:0,desc:"",payType:1,goodsList:[],address:{},addressStation:{},note:"",couponList:[],couponID:0,couponTitle:"",couponPar:0,receiveMethod:1,pickupselfDiscount:0}},computed:c(c({},(0,r.mapState)(["theme","couponGeneralPicture","editionSetting","userInfo"])),{},{baseColor:function(){return"rose_red"===this.theme?"#E71B64":"sapphire_blue"===this.theme?"#002FA7":"#E71B64"},total:function(){var e=0;return this.goodsList.forEach((function(t){t.is_point?e+=t.point_price*t.quantity:e+=t.price*t.quantity})),e},totalPoints:function(){var e=0;return this.goodsList.forEach((function(t){t.is_point&&(e+=t.point*t.quantity)})),e},pids:function(){var e=this.goodsList.map((function(e){return e.pid}));return console.log("goodsList:",this.goodsList),console.log("pids:",e),e.toString()},pickupselfDiscountMoney:function(){return this.editionSetting["enable_pickupself"]&&this.pickupselfDiscount>0&&2===this.receiveMethod&&this.total>this.pickupselfDiscount?this.pickupselfDiscount:0},receiveMethodOptions:function(){return this.editionSetting["enable_pickupself"]&&this.pickupselfDiscount>0&&this.total>this.pickupselfDiscount?[{value:1,text:"快递"},{value:2,text:"自提优惠￥"+this.pickupselfDiscount}]:[{value:1,text:"快递"},{value:2,text:"自提"}]}}),onLoad:function(e){var t=this;return i(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(""!==t.theme){o.next=3;break}return o.next=3,t.$util.loadSetting();case 3:return t.from=e.from,console.log("from:",t.from),"cart"!==t.from&&"product"!==t.from||(t.goodsList=t.$helper.prePage().goodsData,console.log("goodsList:",t.goodsList)),o.next=8,t.loadData();case 8:case"end":return o.stop()}}),o)})))()},onPullDownRefresh:function(){var t=this;return i(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("下拉刷新"),o.next=3,t.loadData();case 3:e.stopPullDownRefresh();case 4:case"end":return o.stop()}}),o)})))()},methods:{loadData:function(){var e=this;return i(n.default.mark((function t(){var o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("loadData"),t.next=3,e.$apis.auth.addressDefault();case 3:return o=t.sent,o.errMsg||(e.address=o,console.log("address:",e.address)),t.next=7,e.$apis.auth.pickupselfConfig();case 7:if(o=t.sent,o.errMsg||(e.pickupselfDiscount=o.data.discount,console.log("pickupselfDiscount:",e.pickupselfDiscount)),!(e.total<=e.pickupselfDiscountMoney)){t.next=11;break}return t.abrupt("return");case 11:return console.log("pickupselfDiscountMoney",e.pickupselfDiscountMoney),t.next=14,e.getCouponShouldUseList(e.pids,e.total-e.pickupselfDiscountMoney);case 14:case"end":return t.stop()}}),t)})))()},toggleMask:function(e){var t=this,o="show"===e?10:300,n="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=n}),o)},numberChange:function(e){this.number=e.number},changePayType:function(e){this.payType=e},submit:function(){var t=this;return i(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(t.goodsList.length){o.next=3;break}return t.$helper.msg("商品列表为空"),o.abrupt("return");case 3:if(1!==t.receiveMethod||t.address.ID){o.next=6;break}return t.$helper.msg("请选择快递收货地址"),o.abrupt("return");case 6:if(2!==t.receiveMethod||t.addressStation.ID){o.next=9;break}return t.$helper.msg("请选择自提点地址"),o.abrupt("return");case 9:if(0!==t.totalPoints){o.next=12;break}return t.createOrder(""),o.abrupt("return");case 12:if(t.userInfo.is_member){o.next=16;break}return t.$helper.msg("请先激活会员"),setTimeout((function(){e.switchTab({url:"/pages/user/user"})}),800),o.abrupt("return");case 16:if(t.userInfo.member_point_password){o.next=20;break}return t.$helper.msg("请先设定积分消费密码"),setTimeout((function(){e.navigateTo({url:"/pages/user/pointPassword"})}),800),o.abrupt("return");case 20:t.show("order_point_password");case 21:case"end":return o.stop()}}),o)})))()},createOrder:function(e){var t=this;return i(n.default.mark((function o(){var r,a,s,i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("createOrder"),console.log("hash:",e),console.log("goodsList",t.goodsList),r={state:1,receive_method:t.receiveMethod,name:t.address.name,mobile:t.address.mobile,area:t.address.area,address:t.address.address,station_name:t.addressStation.station_name,name_s:t.addressStation.name,mobile_s:t.addressStation.mobile,area_s:t.addressStation.area,address_s:t.addressStation.address,note:t.note,coupon_id:t.couponID,point:t.totalPoints},a={data:r,goods_data:t.goodsList},console.log("postdata",a),o.next=8,t.$apis.auth.orderAdd(e,a);case 8:s=o.sent,t.modalData["order_point_password"]="",t.showModal["order_point_password"]=!1,200===s.code?(i=s.data,console.log("oid:",i),t.pay(i)):400===s.code?(t.$helper.msg(s.message),t.couponID=0,t.couponTitle="",t.couponPar=0,t.loadData()):t.$helper.msg("网络错误，请稍候重试");case 12:case"end":return o.stop()}}),o)})))()},pay:function(t){var o=this;return i(n.default.mark((function r(){var a,s;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(o.totalPoints>0&&0===o.total)){r.next=3;break}return e.redirectTo({url:"/pages/money/paySuccess"}),r.abrupt("return");case 3:return a=o,r.next=6,o.$apis.auth.wxaPay(t);case 6:if(s=r.sent,console.log("request:",s),s.Package){r.next=12;break}return o.$helper.msg("网络错误，请稍候重试"),e.redirectTo({url:"/pages/money/payFail?oid=".concat(t)}),r.abrupt("return");case 12:e.requestPayment({provider:"wxpay",timeStamp:s.Timestamp,nonceStr:s.NonceStr,package:s.Package,signType:s.SignType,paySign:s.PaySign,success:function(e){console.log("success:"+JSON.stringify(e))},fail:function(e){console.log("fail:"+JSON.stringify(e))},complete:function(o){var r;(console.log("complete:"+JSON.stringify(o)),e.showLoading({title:"查询支付结果"}),"requestPayment:fail cancel"==o.errMsg)?(e.hideLoading(),e.redirectTo({url:"/pages/money/payFail"})):setTimeout(i(n.default.mark((function o(){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,a.$apis.auth.orderPayResult(t);case 2:r=o.sent,console.log("res:",r),e.hideLoading(),"SUCCESS"===r.data?e.redirectTo({url:"/pages/money/paySuccess"}):e.redirectTo({url:"/pages/money/payUnknown"});case 6:case"end":return o.stop()}}),o)}))),2e3)}});case 13:case"end":return r.stop()}}),r)})))()},changeReceiveMethod:function(){var e=this;return i(n.default.mark((function t(){return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("changeReceiveMethod"),!(e.total<=e.pickupselfDiscountMoney)){t.next=3;break}return t.abrupt("return");case 3:return console.log("pickupselfDiscountMoney",e.pickupselfDiscountMoney),t.next=6,e.getCouponShouldUseList(e.pids,e.total-e.pickupselfDiscountMoney);case 6:case"end":return t.stop()}}),t)})))()},getCouponShouldUseList:function(e,t){var o=this;return i(n.default.mark((function r(){var a,s,i;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("getCouponShouldUseList:",t),o.couponID=0,o.couponTitle="",o.couponPar=0,s=[],n.next=7,o.$apis.auth.couponShouldUseList(e,t);case 7:if(a=n.sent,console.log("couponShouldUseList:",a),a.errMsg||(s=a.data),console.log("list:",s),o.couponList=s,0!==o.couponList.length){n.next=14;break}return n.abrupt("return");case 14:i=o.couponList[0],console.log("first:",i),i.received>0?(o.couponID=i.coupon_id,o.couponTitle=i.product_title,o.couponPar=i.par):o.couponTitle="立即领用，立减￥".concat(i.par);case 17:case"end":return n.stop()}}),r)})))()},toggleCoupon:function(e){var t=this,o="show"===e?10:300,n="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=n}),o)},show:function(e){console.log("show:",e),"member_password"===e&&(this.modalData[e]=""),this.showModal[e]=!0},checkReceive:function(t,o,r,a){var s=this;return i(n.default.mark((function i(){return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!==a){n.next=3;break}return s.receive("",t,o,r),n.abrupt("return");case 3:if(s.userInfo.is_member){n.next=7;break}return s.$helper.msg("请先激活会员"),setTimeout((function(){e.switchTab({url:"/pages/user/user"})}),800),n.abrupt("return");case 7:if(s.userInfo.member_point_password){n.next=11;break}return s.$helper.msg("请先设定积分消费密码"),setTimeout((function(){e.navigateTo({url:"/pages/user/pointPassword"})}),800),n.abrupt("return");case 11:s.modalData.coupon_issue_id=t,s.modalData.title=o,s.modalData.par=r,s.show("member_point_password");case 15:case"end":return n.stop()}}),i)})))()},receive:function(e,t,o,r){var a=this;return i(n.default.mark((function s(){var i,u;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("hash:",e),console.log("couponIssueID:",t),console.log("title:",o),console.log("par:",r),console.log("modalData:",a.modalData),n.next=7,a.$apis.auth.couponReceive(t,e);case 7:i=n.sent,console.log("res:",i),a.modalData["coupon_issue_id"]=0,a.modalData["member_point_password"]="",a.modalData["title"]="",a.modalData["par"]="",a.showModal["member_point_password"]=!1,200===i.code?(u=i.data,a.$helper.msg("领取成功"),a.loadData(),a.use(u,o,r)):400===i.code?(a.$helper.msg(i.message),a.loadData()):a.$helper.msg("网络错误，请稍候重试");case 15:case"end":return n.stop()}}),s)})))()},use:function(e,t,o){var r=this;return i(n.default.mark((function a(){return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("use:",e,t,o),r.couponID=e,r.couponTitle=t,r.couponPar=o,r.toggleCoupon();case 5:case"end":return n.stop()}}),a)})))()},navToCoupon:function(){console.log("navToCoupon");var t="/pages/user/coupon?index=3";e.navigateTo({url:t})},formatDate:function(e){console.log("date:",e);var t=new Date(e);console.log("da:",t);var o=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),a=t.getHours(),s=t.getMinutes(),i=t.getSeconds();return n=n>9?n:"0"+n,r=r>9?r:"0"+r,a=a>9?a:"0"+a,s=s>9?s:"0"+s,i=i>9?i:"0"+i,[o,n,r].join("-")+" "+[a,s,i].join(":")},stopPrevent:function(){}}};t.default=f}).call(this,o("543d")["default"])},"87ba":function(e,t,o){"use strict";var n=o("2450"),r=o.n(n);r.a},"8b5f":function(e,t,o){"use strict";o.r(t);var n=o("4bf7"),r=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},"9b61":function(e,t,o){"use strict";o.r(t);var n=o("1770"),r=o("8b5f");for(var a in r)"default"!==a&&function(e){o.d(t,e,(function(){return r[e]}))}(a);o("87ba");var s,i=o("f0c5"),u=Object(i["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=u.exports}},[["102b","common/runtime","common/vendor"]]]);