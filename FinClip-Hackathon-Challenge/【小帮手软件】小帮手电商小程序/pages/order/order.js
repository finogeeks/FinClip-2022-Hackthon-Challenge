(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order"],{"2f4f":function(e,t,n){"use strict";(function(e){n("2968");r(n("66fd"));var t=r(n("873f"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},4634:function(e,t,n){},"65e5":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("a34a")),o=n("2f62");function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(u){return void n(u)}i.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)}))}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){n.e("components/common/copyright").then(function(){return resolve(n("749f"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/uni-load-more/uni-load-more").then(function(){return resolve(n("0589"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/common/contact").then(function(){return resolve(n("5f19"))}.bind(null,n)).catch(n.oe)},g={components:{uniLoadMore:f,contact:p,copyright:d},data:function(){return{tabCurrentIndex:0,navList:[{state:0,text:"全部",loadingType:"more",orderList:[],pageNo:1,refresh:!1},{state:1,text:"待付款",loadingType:"more",orderList:[],pageNo:1,refresh:!1},{state:2,text:"待发货",loadingType:"more",orderList:[],pageNo:1,refresh:!1},{state:3,text:"待收货",loadingType:"more",orderList:[],pageNo:1,refresh:!1},{state:4,text:"已成交",loadingType:"more",orderList:[],pageNo:1,refresh:!1}]}},computed:u({},(0,o.mapState)(["pageSize","theme","editionSetting"])),onLoad:function(e){var t=this;return i(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(""!==t.theme){n.next=3;break}return n.next=3,t.$util.loadSetting();case 3:return t.editionSetting["enable_refund"]&&(console.log("enableRefund"),t.navList.push({state:6,text:"退款售后",loadingType:"more",orderList:[],pageNo:1,refresh:!1})),console.log("options:",e),t.tabCurrentIndex=+e.index,n.next=8,t.loadData();case 8:case"end":return n.stop()}}),n)})))()},onPullDownRefresh:function(){var t=this;return i(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("下拉刷新"),t.navList[t.tabCurrentIndex].refresh=!0,n.next=4,t.loadData();case 4:e.stopPullDownRefresh();case 5:case"end":return n.stop()}}),n)})))()},methods:{pay:function(t){var n=this;return i(r.default.mark((function o(){var a,s;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=n,o.next=3,n.$apis.auth.wxaPay(t);case 3:if(s=o.sent,console.log("request:",s),s.Package){o.next=8;break}return n.$helper.msg("网络错误，请稍候重试"),o.abrupt("return");case 8:e.requestPayment({provider:"wxpay",timeStamp:s.Timestamp,nonceStr:s.NonceStr,package:s.Package,signType:s.SignType,paySign:s.PaySign,success:function(e){console.log("success:"+JSON.stringify(e))},fail:function(e){console.log("fail:"+JSON.stringify(e))},complete:function(n){var o;(console.log("complete:"+JSON.stringify(n)),e.showLoading({title:"查询支付结果"}),"requestPayment:fail cancel"==n.errMsg)?(e.hideLoading(),a.$helper.msg("支付失败，请稍候重试")):setTimeout(i(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,a.$apis.auth.orderPayResult(t);case 2:o=n.sent,console.log("res:",o),e.hideLoading(),"SUCCESS"===o.data?(a.$helper.msg("支付成功"),a.navList[0].refresh=!0,a.navList[1].refresh=!0,a.navList[2].refresh=!0,a.loadData()):a.$helper.msg("支付未到账，请稍候刷新页面更新状态");case 6:case"end":return n.stop()}}),n)}))),2e3)}});case 9:case"end":return o.stop()}}),o)})))()},navToShip:function(t){var n="/pages/order/ship?oid="+t;e.navigateTo({url:n})},navToDetail:function(t,n,r){console.log("navToDetail:",t,n,r);var o="/pages/order/orderDetail?oid=".concat(t);this.editionSetting["enable_refund"]&&r>0&&(o="/pages/refund/refundLog?oid=".concat(t,"&gid=").concat(n)),e.navigateTo({url:o})},getList:function(e,t,n){var o=this;return i(r.default.mark((function a(){var s,i;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("getList"),console.log("pageSize:",t),r.next=4,o.$apis.auth.orderList(e,t,n);case 4:return s=r.sent,i=[],console.log("res:",s),s.errMsg||(i=s),console.log("res:",s),r.abrupt("return",i);case 10:case"end":return r.stop()}}),a)})))()},loadData:function(e){var t=this;return i(r.default.mark((function n(){var o,a,s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("source:",e),console.log("tabCurrentIndex:",t.tabCurrentIndex),o=t.tabCurrentIndex,a=t.navList[o],s=a.state,a.refresh&&(console.log("refresh"),a.loadingType="",a.loaded="",a.orderList=[],a.pageNo=1,a.refresh=!1),console.log("loadingType:",a.loadingType),console.log("loaded:",a.loaded),console.log("orderList:",a.orderList),"noMore"!==a.loadingType){n.next=11;break}return n.abrupt("return");case 11:if("tabChange"!==e||!0!==a.loaded){n.next=14;break}return console.log("tabChange and loaded"),n.abrupt("return");case 14:if("loading"!==a.loadingType){n.next=16;break}return n.abrupt("return");case 16:return a.loadingType="loading",console.log("state:",s),n.next=20,t.getList(s,t.pageSize,a.pageNo);case 20:i=n.sent,console.log("list:",i),console.log("list.data.items:",i.data.items),i.data.items&&i.data.items.forEach((function(e){console.log("item:",e),e=Object.assign(e,t.orderStateExp(e.data.state,e.data.is_refund,e.data.receive_method)),0===s||6===s?a.orderList.push(e):e.data.is_refund||a.orderList.push(e)})),console.log("navItem:",a),t.$set(a,"loaded",!0),a.pageNo>=i.data.page_count?a.loadingType="noMore":(a.loadingType="more",a.pageNo++);case 27:case"end":return n.stop()}}),n)})))()},changeTab:function(e){this.tabCurrentIndex=e.target.current,this.loadData("tabChange")},tabClick:function(e){this.tabCurrentIndex=e},deleteOrder:function(t){var n=this;console.log("item:",t);var o=this;e.showModal({content:"确定要删除该订单吗？",success:function(){var e=i(r.default.mark((function e(a){var s;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=5;break}return e.next=3,o.$apis.auth.orderDel(t);case 3:s=e.sent,s.errMsg||(n.navList[0].refresh=!0,o.loadData());case 5:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()})},cancelOrder:function(t){var n=this;console.log("order:",t);var o=this;e.showModal({content:"确定要取消该订单吗？",success:function(){var e=i(r.default.mark((function e(a){var s,i;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=7;break}return s={ID:t.ID,coupon_id:t.coupon_id,state:9},console.log("orderData",s),e.next=5,o.$apis.auth.orderProcess(s);case 5:i=e.sent,i.errMsg||(n.navList[0].refresh=!0,n.navList[1].refresh=!0,o.loadData());case 7:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()})},remindExpress:function(e){var t=this;return i(r.default.mark((function n(){var o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("oid:",e),n.next=3,t.$apis.auth.remindExpress(e);case 3:o=n.sent,console.log("res:",o),o.errMsg||t.$helper.msg("已提醒商家发货");case 6:case"end":return n.stop()}}),n)})))()},extendDone:function(e){var t=this;return i(r.default.mark((function n(){var o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("oid:",e),n.next=3,t.$apis.auth.extendDone(e);case 3:o=n.sent,console.log("res:",o),o.errMsg||(t.$helper.msg("已延长自动收货时间"),t.navList[3].refresh=!0,t.loadData());case 6:case"end":return n.stop()}}),n)})))()},doneOrder:function(t){var n=this;console.log("oid:",t);var o=this;e.showModal({content:"确定该订单所有商品已经收到货吗？",success:function(){var e=i(r.default.mark((function e(a){var s,i;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=7;break}return s={ID:t,state:4},console.log("orderData",s),e.next=5,o.$apis.auth.orderProcess(s);case 5:i=e.sent,i.errMsg||(n.navList[0].refresh=!0,n.navList[3].refresh=!0,n.navList[4].refresh=!0,o.loadData());case 7:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()})},orderStateExp:function(e,t,n){var r="";switch(+e){case 1:r="待付款";break;case 2:r="待发货";break;case 3:r="待收货",2===n&&(r="待自提");break;case 4:r="已成交";break;case 8:r="订单已关闭";break;case 9:r="订单已取消";break}return t&&(r="退款售后"),{stateTip:r}},formatDate:function(e){console.log("date:",e);var t=new Date(e);console.log("da:",t);var n=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),a=t.getHours(),s=t.getMinutes(),i=t.getSeconds();return r=r>9?r:"0"+r,o=o>9?o:"0"+o,a=a>9?a:"0"+a,s=s>9?s:"0"+s,i=i>9?i:"0"+i,[n,r,o].join("-")+" "+[a,s,i].join(":")}}};t.default=g}).call(this,n("543d")["default"])},"819f":function(e,t,n){"use strict";var r=n("4634"),o=n.n(r);o.a},"873f":function(e,t,n){"use strict";n.r(t);var r=n("fc44"),o=n("dde6");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("819f");var s,i=n("f0c5"),c=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);t["default"]=c.exports},dde6:function(e,t,n){"use strict";n.r(t);var r=n("65e5"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},fc44:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={uniLoadMore:function(){return n.e("components/uni-load-more/uni-load-more").then(n.bind(null,"0589"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.navList,(function(t,n){var r=e.__get_orig(t),o=!0!==t.loaded||0!==t.orderList.length?e.__map(t.orderList,(function(n,r){var o=e.__get_orig(n),a=e.formatDate(n.data.CreatedAt),s=e.__map(n.goods_data,(function(t,n){var r=e.__get_orig(t),o=0===t.point&&(t.price_pickupself>0||t.price_coupon>0||t.price_discount>0)?e._f("moneyFormat")(t.price-t.price_pickupself-t.price_coupon-t.price_discount):null,a=0===t.point&&(t.price_pickupself>0||t.price_coupon>0||t.price_discount>0)?e._f("moneyFormat")(t.price):null,s=0!==t.point||t.price_pickupself>0||t.price_coupon>0||t.price_discount>0?null:e._f("moneyFormat")(t.price),i=t.point>0&&""!=t.point_price?e._f("moneyFormat")(t.point_price):null;return{$orig:r,f0:o,f1:a,f2:s,f3:i}})),i=6!==t.state&&n.data.pickupself_discount>0?e._f("moneyFormat")(n.data.pickupself_discount):null,c=6!==t.state&&n.data.coupon_par>0?e._f("moneyFormat")(n.data.coupon_par):null,u=6!==t.state&&n.data.discount>0?e._f("moneyFormat")(n.data.discount):null,l=6!==t.state&&n.data.amount>n.data.amount_discount?e._f("moneyFormat")(n.data.amount_discount):null,d=6===t.state||n.data.amount>n.data.amount_discount?null:e._f("moneyFormat")(n.data.amount);return{$orig:o,m0:a,l0:s,f4:i,f5:c,f6:u,f7:l,f8:d}})):null;return{$orig:r,l1:o}})));e.$mp.data=Object.assign({},{$root:{l2:n}})},a=[]}},[["2f4f","common/runtime","common/vendor"]]]);